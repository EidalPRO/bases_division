<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiplicación en Base N</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f4f6f9;
        margin: 0;
        padding: 20px;
        text-align: center;
      }
      .container {
        max-width: 800px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      }
      input,
      button {
        padding: 10px;
        margin: 8px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        width: calc(100% - 22px);
      }
      button {
        background: #28a745;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background: #1c7c31;
      }
      .resultado {
        margin-top: 20px;
        font-size: 20px;
        font-family: monospace;
        text-align: right;
        white-space: pre;
      }
      .linea {
        border-top: 2px solid black;
        display: inline-block;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="/" type="button" class="btn btn-secondary">Regresar</a>
      <h1>Multiplicación en Base N</h1>
      <label>Primer número:</label>
      <input type="text" id="num1" placeholder="Ej: 546" />
      <label>Segundo número:</label>
      <input type="text" id="num2" placeholder="Ej: 36" />
      <label>Base (2–36):</label>
      <input type="number" id="base" min="2" max="36" value="10" />
      <button onclick="multiplicar()">Calcular</button>

      <h2>Resultado</h2>
      <div id="resultado" class="resultado"></div>
    </div>

    <script>
      function charToVal(c) {
        if (!isNaN(c)) return parseInt(c, 10);
        return c.toUpperCase().charCodeAt(0) - 55; // A=10
      }
      function valToChar(v) {
        if (v < 10) return v.toString();
        return String.fromCharCode(v + 55);
      }

      function sumarBase(arr1, arr2, base) {
        let res = [];
        let carry = 0;
        let i = arr1.length - 1,
          j = arr2.length - 1;
        while (i >= 0 || j >= 0 || carry > 0) {
          let x = i >= 0 ? charToVal(arr1[i]) : 0;
          let y = j >= 0 ? charToVal(arr2[j]) : 0;
          let sum = x + y + carry;
          res.unshift(valToChar(sum % base));
          carry = Math.floor(sum / base);
          i--;
          j--;
        }
        return res.join("");
      }

      function multiplicar() {
        let base = parseInt(document.getElementById("base").value);
        let num1 = document.getElementById("num1").value.trim().toUpperCase();
        let num2 = document.getElementById("num2").value.trim().toUpperCase();

        if (!num1 || !num2) {
          document.getElementById("resultado").textContent =
            "⚠️ Ingresa ambos números.";
          return;
        }

        let a = num1.split("").map(charToVal);
        let b = num2.split("").map(charToVal);

        if (a.some((d) => d >= base) || b.some((d) => d >= base)) {
          document.getElementById("resultado").textContent =
            "⚠️ Algún dígito no corresponde a la base.";
          return;
        }

        let parciales = [];
        let shift = 0;

        for (let i = b.length - 1; i >= 0; i--) {
          let digitoB = b[i];
          let carry = 0;
          let parcial = [];

          for (let j = a.length - 1; j >= 0; j--) {
            let digitoA = a[j];
            let prod = digitoA * digitoB + carry;
            carry = Math.floor(prod / base);
            parcial.unshift(valToChar(prod % base));
          }
          if (carry > 0) parcial.unshift(valToChar(carry));

          for (let s = 0; s < shift; s++) parcial.push(" ");
          parciales.push(parcial.join(""));
          shift++;
        }

        // Suma final
        let total = "0";
        for (let p of parciales) {
          total = sumarBase(total, p.replace(/ /g, "0"), base);
        }

        // Formato visual alineado
        let maxLen = Math.max(
          num1.length,
          num2.length + 1,
          ...parciales.map((p) => p.length),
          total.length
        );
        let salida = "";

        salida += num1.padStart(maxLen) + "\n";
        salida += "× " + num2.padStart(maxLen - 2) + "\n";
        salida += "-".repeat(maxLen) + "\n";

        for (let p of parciales) {
          salida += p.padStart(maxLen) + "\n";
        }

        if (parciales.length > 1) {
          salida += "-".repeat(maxLen) + "\n";
          salida += total.padStart(maxLen) + "\n";
        }

        document.getElementById("resultado").textContent = salida;
      }
    </script>
  </body>
</html>
